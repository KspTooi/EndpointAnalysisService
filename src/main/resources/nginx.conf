
#user  nobody;
worker_processes  4;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;
	client_max_body_size 100m;

    sendfile        on;
    keepalive_timeout  65;

    #gzip  on;

	server {
		listen 80;
		#server_name huapai.kzsafe.com;

		location / {
			root /usr/share/nginx/data/flower-arrangement;
			index index.html index.htm;
			try_files $uri $uri/ /index.html;
			client_max_body_size 100m;
		}

		location /api/ {
			rewrite ^/api(.*) $1 break;
			proxy_pass http://127.0.0.1:45001;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		}

	    # MinIO API (供 Java 代码和文件上传下载使用)
		location /minio/ {
			rewrite ^/minio/(.*) /$1 break;
			proxy_pass http://127.0.0.1:9000;

			proxy_set_header Host 127.0.0.1:9000;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;

			# 关键配置
			proxy_http_version 1.1;
			proxy_set_header Connection "";
			chunked_transfer_encoding off;
			proxy_buffering off;
			proxy_request_buffering off;
			client_max_body_size 0;
		}

		# MinIO Console (供浏览器访问管理界面)
		# 访问地址: https://huapai.kzsafe.com:88/console/
		location /console/ {
			rewrite ^/console/(.*) /$1 break;
			proxy_pass http://127.0.0.1:9001;

			proxy_set_header Host $http_host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;

			# 支持 WebSocket (Console 界面需要)
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";
		}
	}

	server {
        listen 443 ssl;
        #server_name huapai.kzsafe.com;
        ssl_certificate /usr/share/nginx/data/cert/huapai.kzsafe.com.pem;
        ssl_certificate_key /usr/share/nginx/data/cert/huapai.kzsafe.com.key;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers HIGH:!aNULL:!MD5;

        location / {
            root /usr/share/nginx/data/flower-arrangement;
            index index.html index.htm;
            try_files $uri $uri/ /index.html;
            client_max_body_size 100m;
        }

        location /api/ {
            rewrite ^/api(.*) $1 break;
            proxy_pass http://127.0.0.1:45001;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /minio/ {
            rewrite ^/minio/(.*) /$1 break;
            proxy_pass http://127.0.0.1:9000;
            proxy_set_header Host 127.0.0.1:9000;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_http_version 1.1;
            proxy_set_header Connection "";
            chunked_transfer_encoding off;
            proxy_buffering off;
            proxy_request_buffering off;
            client_max_body_size 0;
        }

        location /console/ {
            rewrite ^/console/(.*) /$1 break;
            proxy_pass http://127.0.0.1:9001;
            proxy_set_header Host $http_host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }
    }


	server {
		listen 88 ssl;
		server_name huapai.kzsafe.com;

		ssl_certificate /usr/share/nginx/data/cert/huapai.kzsafe.com.pem;
		ssl_certificate_key /usr/share/nginx/data/cert/huapai.kzsafe.com.key;

		ssl_protocols TLSv1.2 TLSv1.3;
		ssl_ciphers HIGH:!aNULL:!MD5;

		location / {
			root /usr/share/nginx/data/flower-arrangement;
			index index.html index.htm;
			try_files $uri $uri/ /index.html;
			client_max_body_size 100m;
		}

		location /api/ {
			rewrite ^/api(.*) $1 break;
			proxy_pass http://127.0.0.1:45001;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		}

	    # MinIO API (供 Java 代码和文件上传下载使用)
		location /minio/ {
			rewrite ^/minio/(.*) /$1 break;
			proxy_pass http://127.0.0.1:9000;

			proxy_set_header Host 127.0.0.1:9000;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;

			# 关键配置
			proxy_http_version 1.1;
			proxy_set_header Connection "";
			chunked_transfer_encoding off;
			proxy_buffering off;
			proxy_request_buffering off;
			client_max_body_size 0;
		}

		# MinIO Console (供浏览器访问管理界面)
		# 访问地址: https://huapai.kzsafe.com:88/console/
		location /console/ {
			rewrite ^/console/(.*) /$1 break;
			proxy_pass http://127.0.0.1:9001;

			proxy_set_header Host $http_host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;

			# 支持 WebSocket (Console 界面需要)
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";
		}
	}




}
